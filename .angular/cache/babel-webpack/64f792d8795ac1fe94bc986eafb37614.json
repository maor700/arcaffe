{"ast":null,"code":"import { __awaiter, __decorate, __metadata } from \"tslib\";\nimport { Component, ApplicationRef, ChangeDetectionStrategy } from '@angular/core';\nimport { bigmaManagerDb } from '@arcaffe/store';\nimport { wktToGeoJSON } from '@terraformer/wkt';\nimport { liveQuery } from 'dexie';\nimport { from } from 'rxjs';\nconst URL_MATERIALS = 'http://localhost:8080/api/materials';\nconst materialsObs$ = from(liveQuery(() => bigmaManagerDb.materials.where('sourceName').equals('materials').toArray()));\nmaterialsObs$.subscribe(arr => console.log('**__ARRIVED__**', arr));\nlet MaterialsListComponent = class MaterialsListComponent {\n  constructor(appRef) {\n    this.appRef = appRef;\n    this.materials$ = from(liveQuery(() => __awaiter(this, void 0, void 0, function* () {\n      const results = yield bigmaManagerDb.materials.where('sourceName').equals('materials').toArray();\n      console.log('inner ', results); // this.appRef.tick();\n\n      return results;\n    })));\n    this.selectedId$ = liveQuery(() => __awaiter(this, void 0, void 0, function* () {\n      var _a;\n\n      return (_a = yield bigmaManagerDb.materials.where('[sourceName+isSelected]').equals(['materials', 1]).first()) === null || _a === void 0 ? void 0 : _a.id;\n    }));\n  }\n\n  ngOnInit() {\n    console.log('');\n    fetch(URL_MATERIALS).then(res => res.json()).then(data => {\n      const newMaterials = data.map(mat => {\n        const {\n          id,\n          additionalProps,\n          geo,\n          displayName\n        } = mat;\n        const {\n          email,\n          phone\n        } = additionalProps;\n        const geometry = geo ? wktToGeoJSON(geo) : null;\n        let geoj = null;\n\n        if (geometry) {\n          geoj = {\n            geometry,\n            type: 'Feature',\n            properties: {\n              name: displayName,\n              content: `name:${displayName} email:${email} phon:${phone}`\n            }\n          };\n        }\n\n        return {\n          id,\n          geo: geoj,\n          sourceName: 'materials',\n          ownerApp: 'materials-app',\n          visibilityOnMap: 'on',\n          type: 'material',\n          additionalProps: additionalProps\n        };\n      });\n      bigmaManagerDb.materials.bulkPut(newMaterials);\n    });\n  }\n\n  userSelectHandler(material) {\n    bigmaManagerDb.selectMaterialToggle(material.id);\n  }\n\n};\nMaterialsListComponent = __decorate([Component({\n  selector: 'arcaffe-materials-list',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  templateUrl: './materials-list.component.html',\n  styleUrls: ['./materials-list.component.less']\n}), __metadata(\"design:paramtypes\", [ApplicationRef])], MaterialsListComponent);\nexport { MaterialsListComponent };","map":null,"metadata":{},"sourceType":"module"}